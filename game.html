<!DOCTYPE html>
<HTML>
	<HEAD>
		<LINK HREF="style.css" REL="stylesheet" TYPE="text/css" />
		<META CONTENT="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" NAME="viewport" />
		<SCRIPT LANGUAGE="javascript" SRC="engine/engine.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/grid.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.floor.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.player.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.stone.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.tree.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity.wood.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entities.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/world.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/camera.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/controls.js" TYPE="text/javascript"></SCRIPT>
		<script language="javascript" src="libraries/binascii.js"></script>
		<script type="text/javascript" src="libraries/jquery.min.js"></script>
		<script type="text/javascript" src="libraries/qrgen/src/jquery.qrcode.js"></script>
		<script type="text/javascript" src="libraries/qrgen/src/qrcode.js"></script>


		<SCRIPT LANGUAGE="javascript" TYPE="text/javascript">
		<!--
			var camera = undefined;

			var world = new World();

			for(var i = 0; i < 5000; i++)
			{
				var tree = new Tree();

				tree.X = (Math.floor(Math.random() * 128) - 64) << 4;
				tree.Y = (Math.floor(Math.random() * 128) - 64) << 4;

				world.Entities.Add(tree);
			}
			
			/*
			//generate simple setup
			tree = new Tree();
			tree.X = 16; tree.Y = 32;
			world.Entities.Add(tree);
			tree = new Tree();
			tree.X = -32; tree.Y = 16;
			world.Entities.Add(tree);
			*/

			var player = new Player();

			player.X = 0;
			player.Y = 0;

			world.Entities.Add(player);

			//

			document.onkeydown = function(event)
			{
				Controls.OnKeyDown(event);
			};

			document.onkeyup = function(event)
			{
				Controls.OnKeyUp(event);
			};

			window.onload = function()
			{

				document.getElementById("btn-export").onclick = function(e) {
					//alert(world.Entities.Export(128,128,-64,-64));
					exported = world.Entities.Export(128,128,-64,-64);
					jQuery('#qr').html('').qrcode(exported).show();

				};
					
				var element = document.getElementById('camera');
				var buttons = new Array('down', 'left', 'right', 'up');
				for(var i in buttons)
				{
					var element = document.getElementById('overlay_dpad_' + buttons[i]);

					if(!element)
					{
						continue;
					}

					element.onmousedown = function(event)
					{
						Controls.Set(event.target.id.substring(13), true);
    				};

					element.onmouseup = function(event)
					{
						Controls.Set(event.target.id.substring(13), false);
    				};

    				element.onmouseout = element.onmouseup;
				}

				{
					var element = document.getElementById('camera');

					if(!element)
					{
						return;
					}

					camera = new Camera(element);

					camera.Render(world);
				}
			};

			window.onresize = function(event)
			{
				camera.OnResize(event);
			}

			Engine.AddListener(function()
			{
				var x = 0;
				var y = 0;

				if(Controls.Get('left'))
				{
					x -= player.Width;
				}

				if(Controls.Get('right'))
				{
					x += player.Width;
				}

				if(Controls.Get('up'))
				{
					y -= player.Height;
				}

				if(Controls.Get('down'))
				{
					y += player.Height;
				}

				if(player.Scan(x, y))
				{
					return;
				}

				// Remove old player object
				player.World.Entities.Grid.Remove(player);
				player.X += x; // Update player obj coords
				player.Y += y; // ditto ^
				// Create new player obj in updated location
				player.World.Entities.Grid.Add(player);

				if(!camera)
				{
					return; // No camera, can't render
				}

				camera.X += x; // Adjust center of screen to track player
				camera.Y += y; // ditto ^

				camera.Render(world);
			});

		//-->
		</SCRIPT>
		<TITLE>I Wanna Be The Game: The Movie: The Game: The Game</TITLE>
	</HEAD>
	<BODY>
		<div id="debug">
			<input type="button" id="btn-export" value="export">
			<div id="qr"></div>
		</div>
		<DIV ID="camera"></DIV>
		<DIV ID="overlay">
			<DIV ID="overlay_dpad">
				<DIV CLASS="button" ID="overlay_dpad_up"></DIV>
				<DIV CLASS="button" ID="overlay_dpad_left"></DIV>
				<DIV CLASS="button" ID="overlay_dpad_right"></DIV>
				<DIV CLASS="button" ID="overlay_dpad_down"></DIV>
			</DIV>
			<DIV ID="overlay_buttons">
			</DIV>
		</DIV>
	</BODY>
</HTML>
