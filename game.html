<!DOCTYPE html>
<HTML>
	<HEAD>
		<LINK HREF="style.css" REL="stylesheet" TYPE="text/css" />
		<META CONTENT="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" NAME="viewport" />
		<SCRIPT LANGUAGE="javascript" SRC="engine/enumerators.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/engine.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/inventory.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/zones.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/grid.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/style.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/controls.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/entity.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/floor.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/items/item.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/items/axe.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/monster.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/player.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/rock.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/snake.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/stone.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/tree.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/weapon.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/wood.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entities.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/world.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/building.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/forest.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/items.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/monsters.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/player.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/generators/rocks.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/items/item.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/items/axe.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/items/wood.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/items/pickaxe.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/items/stone.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/camera.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/menu.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT language="javascript" SRC="libraries/binascii.js"></SCRIPT>
		<SCRIPT TYPE="text/javascript" SRC="libraries/jquery.min.js"></SCRIPT>
		<SCRIPT TYPE"text/javascript" SRC="libraries/qrgen/src/jquery.qrcode.js"></SCRIPT>
		<SCRIPT TYPE="text/javascript" SRC="libraries/qrgen/src/qrcode.js"></SCRIPT>

		<SCRIPT LANGUAGE="javascript" TYPE="text/javascript">

		var pickaxe = new Items_Pickaxe();
		Inventory.Add(pickaxe);

		var axe = new Items_Axe();
		Inventory.Add(axe);

		<!--
			var camera = undefined;

			// Building.Generate();
			// Renderer.Update((Math.floor(Math.random() * 16) - 8) <<4, (Math.floor(Math.random() * 16) - 8) <<4, world);
			
			/*
			//generate simple setup
			tree = new Tree();
			tree.X = 16; tree.Y = 32;
			world.Entities.Add(tree);
			tree = new Tree();
			tree.X = -32; tree.Y = 16;
			world.Entities.Add(tree);
			*/

			var entities = new Array();

			var player = Generators.Player.Generate();

			var avoid = new Array();

			entities.push(player);

			// entities = entities.concat(Generators.Building.Generate(1)); // Causes an infinite loop.
			
			entities = entities.concat(Generators.Forest.Generate(Math.ceil(Math.random() * 2048) + 2048), avoid);
			entities = entities.concat(Generators.Rocks.Generate(Math.ceil(Math.random() * 256) + 128), avoid);
			entities = entities.concat(Generators.Items.Generate(Math.ceil(Math.random() * 4) + 2), avoid);
			entities = entities.concat(Generators.Monsters.Generate(Math.ceil(Math.random() * 16) + 8), avoid);

			var world = new World();

			world.Zones.Add(entities);

			world.Zones.Add(Generators.Rocks.Generate(Math.ceil(Math.random() * 16384)));
			world.Zones.Add(Generators.Forest.Generate(Math.ceil(Math.random() * 16384)));

			//

			document.onkeydown = function(event)
			{
				Controls.OnKeyDown(event);
			};

			document.onkeyup = function(event)
			{
				Controls.OnKeyUp(event);
			};

			window.onload = function()
			{
				document.getElementById("btn-export").onclick = function(e) {
					//alert(world.Entities.Export(128,128,-64,-64));
					exported = world.Entities.Export(128,128,-64,-64);
					//jQuery('#qr').html('').qrcode(exported).show();
					jQuery.ajax({ 
						type: "POST", url: "./world/",
						data: {"world":exported},
						success: function(x) {
							//alert(x);
							jQuery('#url').html('<a href="' + x + '">' + x + '</a>');
							jQuery('#qr').html('').qrcode(x);
							jQuery('#share').show();
						}, dataType: "text"
					});

				};
				document.getElementById("share_close").onclick = function(e) {
					jQuery("#share").hide();
				};

				for(var control in Enums.Controls)
				{
					if(!control)
					{
						continue;
					}

					var element = document.getElementById('overlay_control_' + Enums.Controls[control].ID);

					if(!element)
					{
						continue;
					}

					element.onmousedown = function(event)
					{
						Controls.Set(event.target.id.substring(16), true);
    				};

					element.onmouseup = function(event)
					{
						Controls.Set(event.target.id.substring(16), false);
    				};

    				element.onmouseout = element.onmouseup;
				}

				{
					var element = document.getElementById('menu');

					if(element)
					{
						for(var item in Menu)
						{
							var eItem = document.createElement('div');

							eItem.appendChild(document.createTextNode(Menu[item].Text));

							if(Menu[item].Action)
							{
								eItem.onmouseup = Menu[item].Action;
							}

							element.appendChild(eItem);
						}
					}
				}

				{
					var element = document.getElementById('camera');

					if(!element)
					{
						return;
					}

					camera = new Camera(element);

					camera.X = player.X;
					camera.Y = player.Y;

					camera.Render(world);
				}
			};

			window.onresize = function(event)
			{
				camera.OnResize(event);
			}

			Engine.AddListener(function(cycles)
			{
				if(Controls.Get(Enums.Controls.Inventory))
				{
					var element = document.getElementById('inventory');

					if(element)
					{
						switch(element.style.display)
						{
							case 'none':
								Engine.Paused = true;
								Inventory.Render(element);
								element.style.display = 'block';
								break;

							default:
								element.style.display = 'none';
								Engine.Paused = false;
								break;
						}
					}
				}

				if(Engine.Paused)
				{
					return;
				}

				if(Controls.Get(Enums.Controls.Action))
				{
					Inventory.OnAction();
				}

				var x = 0;
				var y = 0;

				for(var direction in Enums.Directions)
				{
					if(!direction)
					{
						continue;
					}

					if(!Enums.Controls[direction])
					{
						continue;
					}

					if(!Controls.Get(Enums.Controls[direction]))
					{
						continue;
					}

					x += Enums.Directions[direction].X * player.Width;
					y += Enums.Directions[direction].Y * player.Height;

					if(!Controls.Get(Enums.Controls.Strafe))
					{
						player.Direction = direction;
					}
				}

				if(player.Scan(x, y))
				{
					x = 0;
					y = 0;
				}
				else
				{
					// Remove old player object
					player.World.Entities.Grid.Remove(player);
					player.X += x; // Update player obj coords
					player.Y += y; // ditto ^
					// Create new player obj in updated location
					player.World.Entities.Grid.Add(player);
				}

				if(!camera)
				{
					return; // No camera, can't render
				}

				camera.X += x; // Adjust center of screen to track player
				camera.Y += y; // ditto ^

				camera.Render(world);
			});

		//-->
		</SCRIPT>
		<TITLE>When Planets Kiss: The Game: The Movie: The Game: The Book: The Game: The Comic: The Website: The Podcast</TITLE>
	</HEAD>
	<BODY>
		<DIV ID="camera"></DIV><!-- end camera -->

		<DIV ID="overlay">
			<div id="debug" style="position: absolute; top: 70px;">

			</div>
			<DIV ID="overlay_dpad">
				<DIV CLASS="button" ID="overlay_control_up"></DIV>
				<DIV CLASS="button" ID="overlay_control_left"></DIV>
				<DIV CLASS="button" ID="overlay_control_right"></DIV>
				<DIV CLASS="button" ID="overlay_control_down"></DIV>
			</DIV><!-- end overlay_dpad -->
			
			<DIV ID="overlay_buttons">
				<DIV CLASS="button" ID="overlay_control_action"></DIV>
			</DIV><!-- end overlay_buttons -->
			
			<DIV ID="overlay_menu">
					<NAV> 
					<UL id="menu_desktop"> 
					<LI>
						<a id="btn-export" href="#">Share</a>
						<div id="share">
							<div id="url"></div>
							<div id="qr"></div>
							<button id="share_close">Okay, done sharing</button>
						</div>

					</LI> 
					<LI><A href="https://github.com/makerslocal/LudumDare30" target="new">Github</A></LI>
					</UL>
					
					<SCRIPT LANGUAGE="javascript" TYPE="text/javascript">
						document.getElementById("menu_mobile").onchange = function () {
							alert('changed');
							if (this.selectedIndex > 1) {
								window.location.href = this.value;
							}
							if (this.selectedIndex == 1) {
								alert('here');
								window.location.href = this.value;
							}
						}
					</SCRIPT>
					
					<SELECT id="menu_mobile">
					<OPTION value="#" selected="selected">Menu</OPTION> 
					<OPTION value="#" id="btn-export-mobile">Export</OPTION> 
					<OPTION value="https://github.com/makerslocal/LudumDare30">Github</OPTION>
					</SELECT>
					</NAV>
			</DIV><!-- end #overlay_menu -->
		</DIV><!-- end #overlay -->
		<DIV ID="menu"></DIV>
		<DIV ID="inventory">
			<DIV CLASS="modal"></DIV>
			<DIV ID="inventory_items"></DIV>
		</DIV>
	</BODY>
</HTML>
