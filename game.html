<!DOCTYPE html>
<HTML>
	<HEAD>
		<LINK HREF="style.css" REL="stylesheet" TYPE="text/css" />
		<META CONTENT="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" NAME="viewport" />
		<SCRIPT LANGUAGE="javascript" SRC="engine/enumerators.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/engine.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/grid.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/style.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/entity.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/floor.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/player.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/stone.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/tree.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/weapon.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/item.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entity/wood.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/entities.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/world.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/camera.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="engine/controls.js" TYPE="text/javascript"></SCRIPT>
		<SCRIPT language="javascript" SRC="libraries/binascii.js"></SCRIPT>
		<SCRIPT TYPE="text/javascript" SRC="libraries/jquery.min.js"></SCRIPT>
		<SCRIPT TYPE"text/javascript" SRC="libraries/qrgen/src/jquery.qrcode.js"></SCRIPT>
		<SCRIPT TYPE="text/javascript" SRC="libraries/qrgen/src/qrcode.js"></SCRIPT>


		<SCRIPT LANGUAGE="javascript" TYPE="text/javascript">
		<!--
			var camera = undefined;

			var world = new World();

			for(var i = 0; i < 5000; i++)
			{
				var tree = new Tree();

				tree.X = (Math.floor(Math.random() * 124) - 64) << 4;
				tree.Y = (Math.floor(Math.random() * 128) - 64) << 4;

				world.Entities.Add(tree);
			}
			
			/*
			//generate simple setup
			tree = new Tree();
			tree.X = 16; tree.Y = 32;
			world.Entities.Add(tree);
			tree = new Tree();
			tree.X = -32; tree.Y = 16;
			world.Entities.Add(tree);
			*/

			var player = new Player();

			player.X = 0;
			player.Y = 0;

			world.Entities.Add(player);

			var item = new Item();

			item.X = (Math.floor(Math.random() * 64) - 32) << 4;
			item.Y = (Math.floor(Math.random() * 64) - 32) << 4;

			world.Entities.Add(item);

			//

			document.onkeydown = function(event)
			{
				Controls.OnKeyDown(event);
			};

			document.onkeyup = function(event)
			{
				Controls.OnKeyUp(event);
			};

			window.onload = function()
			{
				document.getElementById("btn-export").onclick = function(e) {
					//alert(world.Entities.Export(128,128,-64,-64));
					exported = world.Entities.Export(128,128,-64,-64);
					jQuery('#qr').html('').qrcode(exported).show();

				};

				for(var control in Enums.Controls)
				{
					if(!control)
					{
						continue;
					}

					var element = document.getElementById('overlay_control_' + Enums.Controls[control].ID);

					if(!element)
					{
						continue;
					}

					element.onmousedown = function(event)
					{
						Controls.Set(event.target.id.substring(16), true);
    				};

					element.onmouseup = function(event)
					{
						Controls.Set(event.target.id.substring(16), false);
    				};

    				element.onmouseout = element.onmouseup;
				}

				{
					var element = document.getElementById('camera');

					if(!element)
					{
						return;
					}

					camera = new Camera(element);

					camera.Render(world);
				}
			};

			window.onresize = function(event)
			{
				camera.OnResize(event);
			}

			Engine.AddListener(function()
			{
				var x = 0;
				var y = 0;

				for(var direction in Enums.Directions)
				{
					if(!direction)
					{
						continue;
					}

					if(!Enums.Controls[direction])
					{
						continue;
					}

					if(!Controls.Get(Enums.Controls[direction]))
					{
						continue;
					}

					x += Enums.Directions[direction].X * player.Width;
					y += Enums.Directions[direction].Y * player.Height;

					player.Direction = Enums.Directions[direction].ID;
				}

				if(player.Scan(x, y))
				{
					return;
				}

				// Remove old player object
				player.World.Entities.Grid.Remove(player);
				player.X += x; // Update player obj coords
				player.Y += y; // ditto ^
				// Create new player obj in updated location
				player.World.Entities.Grid.Add(player);

				if(!camera)
				{
					return; // No camera, can't render
				}

				camera.X += x; // Adjust center of screen to track player
				camera.Y += y; // ditto ^

				camera.Render(world);
			});

		//-->
		</SCRIPT>
		<TITLE>I Wanna Be The Game: The Movie: The Game: The Book: The Game: The Comic: The Website</TITLE>
	</HEAD>
	<BODY>
		<DIV ID="camera"></DIV><!-- end camera -->

		<DIV ID="overlay">
			<div id="debug" style="position: absolute; top: 70px;"><div id="qr"></div></div>
			<DIV ID="overlay_dpad">
				<DIV CLASS="button" ID="overlay_control_up"></DIV>
				<DIV CLASS="button" ID="overlay_control_left"></DIV>
				<DIV CLASS="button" ID="overlay_control_right"></DIV>
				<DIV CLASS="button" ID="overlay_control_down"></DIV>
			</DIV><!-- end overlay_dpad -->
			
			<DIV ID="overlay_buttons">
				<DIV CLASS="button" ID="overlay_control_action"></DIV>
			</DIV><!-- end overlay_buttons -->
			
			<DIV ID="overlay_menu">
					<NAV> 
					<UL> 
					<LI><a id="btn-export" href="#">Export</a></LI> 
					<LI><A href="https://github.com/makerslocal/LudumDare30" target="new">Github</A></LI>
					
					<SELECT> 
					<OPTION value="" selected="selected">Select</OPTION> 
					<OPTION value="#">Export</OPTION> 
					<OPTION value="https://github.com/makerslocal/LudumDare30">Github</OPTION>
					</SELECT> 
					</NAV>
			</DIV><!-- end #overlay_menu -->
		</DIV><!-- end #overlay -->
	</BODY>
</HTML>
